name: quickstart-lab

# This lab uses only publicly available images and works out-of-the-box
# No VRNetlab or custom image builds required

topology:
  nodes:
    # Nokia SR Linux switches
    srl-spine:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:latest
      mgmt-ipv4: 172.20.20.10
      startup-config: |
        set / system information location "Quickstart Lab - Spine"
        set / system aaa authentication admin-user password admin
        
        set / interface ethernet-1/1 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 address 10.0.1.1/24
        
        set / interface ethernet-1/2 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 address 10.0.2.1/24
        
        set / network-instance default type default
        set / network-instance default interface ethernet-1/1.0
        set / network-instance default interface ethernet-1/2.0
        
        set / network-instance default protocols bgp admin-state enable
        set / network-instance default protocols bgp router-id 10.0.0.1
        set / network-instance default protocols bgp autonomous-system 65000
        set / network-instance default protocols bgp group ebgp ipv4-unicast admin-state enable
    
    srl-leaf1:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:latest
      mgmt-ipv4: 172.20.20.11
      startup-config: |
        set / system information location "Quickstart Lab - Leaf 1"
        set / system aaa authentication admin-user password admin
        
        set / interface ethernet-1/1 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 address 10.0.1.2/24
        
        set / interface ethernet-1/2 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 address 10.0.10.1/24
        
        set / network-instance default type default
        set / network-instance default interface ethernet-1/1.0
        set / network-instance default interface ethernet-1/2.0
        
        set / network-instance default protocols bgp admin-state enable
        set / network-instance default protocols bgp router-id 10.0.0.2
        set / network-instance default protocols bgp autonomous-system 65001
        set / network-instance default protocols bgp group ebgp peer-as 65000
        set / network-instance default protocols bgp group ebgp ipv4-unicast admin-state enable
        set / network-instance default protocols bgp neighbor 10.0.1.1 peer-group ebgp
    
    srl-leaf2:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:latest
      mgmt-ipv4: 172.20.20.12
      startup-config: |
        set / system information location "Quickstart Lab - Leaf 2"
        set / system aaa authentication admin-user password admin
        
        set / interface ethernet-1/1 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 address 10.0.2.2/24
        
        set / interface ethernet-1/2 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 address 10.0.20.1/24
        
        set / network-instance default type default
        set / network-instance default interface ethernet-1/1.0
        set / network-instance default interface ethernet-1/2.0
        
        set / network-instance default protocols bgp admin-state enable
        set / network-instance default protocols bgp router-id 10.0.0.3
        set / network-instance default protocols bgp autonomous-system 65002
        set / network-instance default protocols bgp group ebgp peer-as 65000
        set / network-instance default protocols bgp group ebgp ipv4-unicast admin-state enable
        set / network-instance default protocols bgp neighbor 10.0.2.1 peer-group ebgp
    
    # FRRouting routers
    frr-router1:
      kind: linux
      image: frrouting/frr:latest
      mgmt-ipv4: 172.20.20.20
      exec:
        - |
          cat > /etc/frr/daemons <<EOF
          bgpd=yes
          ospfd=yes
          zebra=yes
          EOF
        - |
          cat > /etc/frr/frr.conf <<EOF
          hostname frr-router1
          password admin
          enable password admin
          !
          interface eth1
           ip address 10.0.10.2/24
          !
          router bgp 65001
           bgp router-id 10.0.10.2
           neighbor 10.0.10.1 remote-as 65001
           !
           address-family ipv4 unicast
            network 10.0.10.0/24
            neighbor 10.0.10.1 activate
           exit-address-family
          !
          line vty
          !
          EOF
        - /usr/lib/frr/frrinit.sh start
    
    frr-router2:
      kind: linux
      image: frrouting/frr:latest
      mgmt-ipv4: 172.20.20.21
      exec:
        - |
          cat > /etc/frr/daemons <<EOF
          bgpd=yes
          ospfd=yes
          zebra=yes
          EOF
        - |
          cat > /etc/frr/frr.conf <<EOF
          hostname frr-router2
          password admin
          enable password admin
          !
          interface eth1
           ip address 10.0.20.2/24
          !
          router bgp 65002
           bgp router-id 10.0.20.2
           neighbor 10.0.20.1 remote-as 65002
           !
           address-family ipv4 unicast
            network 10.0.20.0/24
            neighbor 10.0.20.1 activate
           exit-address-family
          !
          line vty
          !
          EOF
        - /usr/lib/frr/frrinit.sh start
    
    # Test clients
    client1:
      kind: linux
      image: nicolaka/netshoot:latest
      mgmt-ipv4: 172.20.20.30
      exec:
        - ip addr add 10.0.10.10/24 dev eth1
        - ip route add default via 10.0.10.1
    
    client2:
      kind: linux
      image: nicolaka/netshoot:latest
      mgmt-ipv4: 172.20.20.31
      exec:
        - ip addr add 10.0.20.10/24 dev eth1
        - ip route add default via 10.0.20.1
  
  links:
    - endpoints: ["srl-spine:e1-1", "srl-leaf1:e1-1"]
    - endpoints: ["srl-spine:e1-2", "srl-leaf2:e1-1"]
    - endpoints: ["srl-leaf1:e1-2", "frr-router1:eth1"]
    - endpoints: ["srl-leaf2:e1-2", "frr-router2:eth1"]
    - endpoints: ["frr-router1:eth2", "client1:eth1"]
    - endpoints: ["frr-router2:eth2", "client2:eth1"]
