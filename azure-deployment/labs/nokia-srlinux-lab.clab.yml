name: nokia-srlinux-lab

topology:
  defaults:
    kind: nokia_srlinux
  
  nodes:
    # Nokia SR Linux Leaf-Spine Fabric
    srl-spine-1:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:latest
      mgmt-ipv4: 172.20.20.60
      startup-config: |
        set / system information location "Data Center - Spine 1"
        set / system information contact "admin@example.com"
        set / system aaa authentication admin-user password admin
        
        set / interface ethernet-1/1 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 address 10.5.1.1/24
        
        set / interface ethernet-1/2 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/2 subinterface 0 ipv4 address 10.5.2.1/24
        
        set / interface ethernet-1/3 admin-state enable
        set / interface ethernet-1/3 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/3 subinterface 0 ipv4 address 10.5.3.1/24
        
        set / network-instance default type default
        set / network-instance default interface ethernet-1/1.0
        set / network-instance default interface ethernet-1/2.0
        set / network-instance default interface ethernet-1/3.0
        
        set / network-instance default protocols bgp admin-state enable
        set / network-instance default protocols bgp router-id 10.5.0.1
        set / network-instance default protocols bgp autonomous-system 65000
        set / network-instance default protocols bgp group ebgp ipv4-unicast admin-state enable
    
    srl-leaf-1:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:latest
      mgmt-ipv4: 172.20.20.61
      startup-config: |
        set / system information location "Data Center - Leaf 1"
        set / system information contact "admin@example.com"
        set / system aaa authentication admin-user password admin
        
        set / interface ethernet-1/1 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 address 10.5.1.2/24
        
        set / interface ethernet-1/2 admin-state enable
        set / interface ethernet-1/2 vlan-tagging true
        set / interface ethernet-1/2 subinterface 10 type bridged
        set / interface ethernet-1/2 subinterface 10 vlan encap single-tagged vlan-id 10
        
        set / network-instance default type default
        set / network-instance default interface ethernet-1/1.0
        
        set / network-instance vlan10 type mac-vrf
        set / network-instance vlan10 interface ethernet-1/2.10
        
        set / network-instance default protocols bgp admin-state enable
        set / network-instance default protocols bgp router-id 10.5.0.2
        set / network-instance default protocols bgp autonomous-system 65001
        set / network-instance default protocols bgp group ebgp peer-as 65000
        set / network-instance default protocols bgp group ebgp ipv4-unicast admin-state enable
        set / network-instance default protocols bgp neighbor 10.5.1.1 peer-group ebgp
    
    srl-leaf-2:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:latest
      mgmt-ipv4: 172.20.20.62
      startup-config: |
        set / system information location "Data Center - Leaf 2"
        set / system information contact "admin@example.com"
        set / system aaa authentication admin-user password admin
        
        set / interface ethernet-1/1 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 address 10.5.2.2/24
        
        set / interface ethernet-1/2 admin-state enable
        set / interface ethernet-1/2 vlan-tagging true
        set / interface ethernet-1/2 subinterface 10 type bridged
        set / interface ethernet-1/2 subinterface 10 vlan encap single-tagged vlan-id 10
        
        set / network-instance default type default
        set / network-instance default interface ethernet-1/1.0
        
        set / network-instance vlan10 type mac-vrf
        set / network-instance vlan10 interface ethernet-1/2.10
        
        set / network-instance default protocols bgp admin-state enable
        set / network-instance default protocols bgp router-id 10.5.0.3
        set / network-instance default protocols bgp autonomous-system 65002
        set / network-instance default protocols bgp group ebgp peer-as 65000
        set / network-instance default protocols bgp group ebgp ipv4-unicast admin-state enable
        set / network-instance default protocols bgp neighbor 10.5.2.1 peer-group ebgp
    
    srl-leaf-3:
      kind: nokia_srlinux
      image: ghcr.io/nokia/srlinux:latest
      mgmt-ipv4: 172.20.20.63
      startup-config: |
        set / system information location "Data Center - Leaf 3"
        set / system information contact "admin@example.com"
        set / system aaa authentication admin-user password admin
        
        set / interface ethernet-1/1 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 admin-state enable
        set / interface ethernet-1/1 subinterface 0 ipv4 address 10.5.3.2/24
        
        set / interface ethernet-1/2 admin-state enable
        set / interface ethernet-1/2 vlan-tagging true
        set / interface ethernet-1/2 subinterface 10 type bridged
        set / interface ethernet-1/2 subinterface 10 vlan encap single-tagged vlan-id 10
        
        set / network-instance default type default
        set / network-instance default interface ethernet-1/1.0
        
        set / network-instance vlan10 type mac-vrf
        set / network-instance vlan10 interface ethernet-1/2.10
        
        set / network-instance default protocols bgp admin-state enable
        set / network-instance default protocols bgp router-id 10.5.0.4
        set / network-instance default protocols bgp autonomous-system 65003
        set / network-instance default protocols bgp group ebgp peer-as 65000
        set / network-instance default protocols bgp group ebgp ipv4-unicast admin-state enable
        set / network-instance default protocols bgp neighbor 10.5.3.1 peer-group ebgp
    
    # RADIUS Server
    radius-server:
      kind: linux
      image: portnox/portnox-radius:latest
      mgmt-ipv4: 172.20.20.101
      ports:
        - 1812:1812/udp
        - 1813:1813/udp
    
    # TACACS+ Server
    tacacs-server:
      kind: linux
      image: portnox/portnox-tacacs:latest
      mgmt-ipv4: 172.20.20.100
      ports:
        - 49:49/tcp
    
    # Test Clients
    client-1:
      kind: linux
      image: ubuntu:22.04
      mgmt-ipv4: 172.20.20.208
      exec:
        - apt-get update
        - apt-get install -y wpasupplicant iproute2
    
    client-2:
      kind: linux
      image: ubuntu:22.04
      mgmt-ipv4: 172.20.20.209
      exec:
        - apt-get update
        - apt-get install -y wpasupplicant iproute2
    
    client-3:
      kind: linux
      image: ubuntu:22.04
      mgmt-ipv4: 172.20.20.210
      exec:
        - apt-get update
        - apt-get install -y wpasupplicant iproute2
  
  links:
    - endpoints: ["srl-spine-1:e1-1", "srl-leaf-1:e1-1"]
    - endpoints: ["srl-spine-1:e1-2", "srl-leaf-2:e1-1"]
    - endpoints: ["srl-spine-1:e1-3", "srl-leaf-3:e1-1"]
    - endpoints: ["srl-leaf-1:e1-2", "client-1:eth1"]
    - endpoints: ["srl-leaf-2:e1-2", "client-2:eth1"]
    - endpoints: ["srl-leaf-3:e1-2", "client-3:eth1"]
